define(["jquery","socket","functions","EventEmitter","multiplex","bootstrap","jquery.cookie"],function(e,o,n,t){function s(){var d=o("http://192.168.1.116:377/chat"),u=new WebSocketMultiplex(d),m=u.channel("auth");r=m;var l=new t;d.onerror=function(e){console.error("err",e)},d.onclose=function(){n.disconnect(++i),setTimeout(s,2e3)},m.onmessage=function(e){e=JSON.parse(e.data),console.log(e.type,e.data),e.type?l.emit(e.type,e.data):console.error("Сообщение без типа!",e)},m.onopen=function(){i=0,e.cookie("nick")&&"false"!=e.cookie("nick")?n.send_socket("auth_id",e.cookie("nick"),m):n.modal(".auth_modal"),n.modal(".connect_modal",!0)},l.on("auth",function(o){e.cookie("nick",o.id),window.nick=o.nick,n.modal(".auth_modal",!0),n.update_users(o.users),n.update_room(o.rooms)}),l.on("update",function(e){e.users&&n.update_users(e.users),e.rooms&&n.update_room(e.rooms)}),l.on("auth_err",function(e){n.modal(".auth_modal"),alert(e)}),l.on("alert",function(e){alert(e)}),n.set_socket({auth:function(e){console.log(e),n.send_socket("auth",e,m)},room_disconnect:function(e){console.log("disconnect",e),n.send_socket("disconnect",e,a),console.log("room_disconnect",e,JSON.parse('"'+a.name+'"'))},room_set:function(o,s){console.log("room_set",o),a=u.channel(s),c=new t,a.onmessage=function(e){e=JSON.parse(e.data),console.log(e.type,e.data),e.type?c.emit(e.type,e.data):console.error("Сообщение без типа!",e)},c.on("update",function(e){e.users&&n.update_users(e.users),e.rooms&&n.update_room(e.rooms)}),c.on("alert",function(e){alert(e)}),c.on("del_message",function(o){e('.list-messages tr[data-id="'+o+'"]').remove()}),c.on("room",function(o){e(".mess_send").removeAttr("disabled"),e(".mess_send").parent().parent().find("input").removeAttr("disabled"),e(".list-messages").empty(),n.update_users(o.users),console.log(o.chat);for(time in o.chat){console.log(time,n.get_date(time));var t=o.chat[time];n.add_mess(t.user_name,t.message,time,t.id)}e(".del_message").off("click").click(function(){var o=e(this).parent().parent().data("id");n.send_socket("del_message",o,a)})}),c.on("message",function(o){n.add_mess(o.name,o.text,o.time,o.id),e(".del_message").off("click").click(function(){var o=e(this).parent().parent().data("id");n.send_socket("del_message",o,a)})}),a.onopen=function(){console.log("connect",o,s),n.send_socket("connect",s,a)}}})}var a,c,r,i=0;return s(),{add_room:function(e){console.log("add_room",e),n.send_socket("add_room",e,r)},send:function(e){n.send_socket("message",e,a)}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJuYW1lcyI6WyJkZWZpbmUiLCIkIiwiU29ja0pTIiwiY2hhdCIsIkV2ZW50RW1pdHRlciIsInN0YXJ0Iiwic29ja2V0IiwibXVsdGlwbGV4ZXIiLCJXZWJTb2NrZXRNdWx0aXBsZXgiLCJhdXRoX3NvY2tldCIsImNoYW5uZWwiLCJhdXRoX3NvY2tldF9nbG9iYWwiLCJhdXRoIiwib25lcnJvciIsImUiLCJjb25zb2xlIiwiZXJyb3IiLCJvbmNsb3NlIiwiZGlzY29ubmVjdCIsInJlY29ubmVjdCIsInNldFRpbWVvdXQiLCJvbm1lc3NhZ2UiLCJkYXRhIiwiSlNPTiIsInBhcnNlIiwibG9nIiwidHlwZSIsImVtaXQiLCJvbm9wZW4iLCJjb29raWUiLCJzZW5kX3NvY2tldCIsIm1vZGFsIiwib24iLCJpZCIsIndpbmRvdyIsIm5pY2siLCJ1cGRhdGVfdXNlcnMiLCJ1c2VycyIsInVwZGF0ZV9yb29tIiwicm9vbXMiLCJhbGVydCIsInNldF9zb2NrZXQiLCJuYW1lIiwicm9vbV9kaXNjb25uZWN0Iiwic29ja2V0X3Jvb20iLCJyb29tX3NldCIsInJvb20iLCJyZW1vdmUiLCJyZW1vdmVBdHRyIiwicGFyZW50IiwiZmluZCIsImVtcHR5IiwidGltZSIsImdldF9kYXRlIiwibWVzcyIsImFkZF9tZXNzIiwidXNlcl9uYW1lIiwibWVzc2FnZSIsIm9mZiIsImNsaWNrIiwidGhpcyIsInRleHQiLCJhZGRfcm9vbSIsInNlbmQiXSwibWFwcGluZ3MiOiJBQUFBQSxRQUFRLFNBQVUsU0FBVSxZQUFhLGVBQWUsWUFBYSxZQUFhLGlCQUFrQixTQUFVQyxFQUFHQyxFQUFRQyxFQUFNQyxHQU0zSCxRQUFTQyxLQUNMLEdBQUlDLEdBQVNKLEVBQU8saUNBQ2hCSyxFQUFjLEdBQUlDLG9CQUFtQkYsR0FDckNHLEVBQWNGLEVBQVlHLFFBQVEsT0FDdENDLEdBQXFCRixDQUNyQixJQUFJRyxHQUFPLEdBQUlSLEVBRWZFLEdBQU9PLFFBQVUsU0FBVUMsR0FD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LEdBQUtvRCxTQUFTRCxFQUFLRSxVQUFXRixFQUFLRyxRQUFTTCxLQUFNRSxFQUFLckIsSUFFM0RoQyxFQUFFLGdCQUFnQnlELElBQUksU0FBU0MsTUFBTSxXQUNqQyxHQUFJMUIsR0FBS2hDLEVBQUUyRCxNQUFNWCxTQUFTQSxTQUFTM0IsS0FBSyxLQUN4Q25CLEdBQUsyQixZQUFZLGNBQWVHLEVBQUlXLE9BRzVDRSxFQUFLZCxHQUFHLFVBQVcsU0FBVVYsR0FDekJuQixFQUFLb0QsU0FBU2pDLEVBQUtvQixLQUFNcEIsRUFBS3VDLEtBQU12QyxFQUFLOEIsS0FBTTlCLEVBQUtXLElBQ3BEaEMsRUFBRSxnQkFBZ0J5RCxJQUFJLFNBQVNDLE1BQU0sV0FDakMsR0FBSTFCLEdBQUtoQyxFQUFFMkQsTUFBTVgsU0FBU0EsU0FBUzNCLEtBQUssS0FDeENuQixHQUFLMkIsWUFBWSxjQUFlRyxFQUFJVyxPQUk1Q0EsRUFBWWhCLE9BQVMsV0FDakJiLFFBQVFVLElBQUksVUFBV2lCLEVBQU1ULEdBQzdCOUIsRUFBSzJCLFlBQVksVUFBV0csRUFBSVcsT0FuSGhELEdBQUlBLEdBQWFFLEVBQXFCbkMsRUFBZlEsRUFBWSxDQXlIbkMsT0F4SEFkLE1BeUhJeUQsU0FBVSxTQUFVcEIsR0FDaEIzQixRQUFRVSxJQUFJLFdBQVdpQixHQUN2QnZDLEVBQUsyQixZQUFZLFdBQVlZLEVBQU0vQixJQUV2Q29ELEtBQU0sU0FBVXpDLEdBQ1puQixFQUFLMkIsWUFBWSxVQUFXUixFQUFNc0IiLCJmaWxlIjoic2VydmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFsnanF1ZXJ5JywgJ3NvY2tldCcsICdmdW5jdGlvbnMnLCAnRXZlbnRFbWl0dGVyJywnbXVsdGlwbGV4JywgJ2Jvb3RzdHJhcCcsICdqcXVlcnkuY29va2llJ10sIGZ1bmN0aW9uICgkLCBTb2NrSlMsIGNoYXQsIEV2ZW50RW1pdHRlcikge1xuICAgIC8qXG4gICAgINCf0L7QtNC60LvRjtGH0LXQvdC40LUg0Lgg0L7QsdGA0LDQsdC+0YLQutCwINC60L7QvNCw0L3QtCDRgdC10YDQstC10YDQsFxuICAgICAqL1xuICAgIHZhciBzb2NrZXRfcm9vbSwgcm9vbSwgcmVjb25uZWN0ID0gMCwgYXV0aF9zb2NrZXRfZ2xvYmFsO1xuICAgIHN0YXJ0KCk7XG4gICAgZnVuY3Rpb24gc3RhcnQoKSB7XG4gICAgICAgIHZhciBzb2NrZXQgPSBTb2NrSlMoJ2h0dHA6Ly8xOTIuMTY4LjEuMTE2OjM3Ny9jaGF0Jyk7XG4gICAgICAgIHZhciBtdWx0aXBsZXhlciA9IG5ldyBXZWJTb2NrZXRNdWx0aXBsZXgoc29ja2V0KTtcbiAgICAgICAgdmFyIGF1dGhfc29ja2V0ID0gbXVsdGlwbGV4ZXIuY2hhbm5lbCgnYXV0aCcpO1xuICAgICAgICBhdXRoX3NvY2tldF9nbG9iYWwgPSBhdXRoX3NvY2tldDtcbiAgICAgICAgdmFyIGF1dGggPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICAgICAgc29ja2V0Lm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignZXJyJywgZSk7XG4gICAgICAgIH1cbiAgICAgICAgc29ja2V0Lm9uY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjaGF0LmRpc2Nvbm5lY3QoKytyZWNvbm5lY3QpO1xuICAgICAgICAgICAgc2V0VGltZW91dChzdGFydCwgMjAwMCk7XG4gICAgICAgIH1cbiAgICAgICAgYXV0aF9zb2NrZXQub25tZXNzYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGRhdGEuZGF0YSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhLnR5cGUsIGRhdGEuZGF0YSk7XG4gICAgICAgICAgICBpZiAoZGF0YS50eXBlKSBhdXRoLmVtaXQoZGF0YS50eXBlLCBkYXRhLmRhdGEpO1xuICAgICAgICAgICAgZWxzZSBjb25zb2xlLmVycm9yKCfQodC+0L7QsdGJ0LXQvdC40LUg0LHQtdC3INGC0LjQv9CwIScsIGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGF1dGhfc29ja2V0Lm9ub3BlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlY29ubmVjdCA9IDA7XG4gICAgICAgICAgICBpZigkLmNvb2tpZSgnbmljaycpICYmICQuY29va2llKCduaWNrJykgIT0gJ2ZhbHNlJykge1xuICAgICAgICAgICAgICAgIC8vJCgnLmlucHV0TmFtZScpLnZhbCgkLmNvb2tpZSgnbmljaycpKTtcbiAgICAgICAgICAgICAgICAvL2NoYXQuYXV0aF9jaGVjaygpO1xuICAgICAgICAgICAgICAgIGNoYXQuc2VuZF9zb2NrZXQoJ2F1dGhfaWQnLCAkLmNvb2tpZSgnbmljaycpLCBhdXRoX3NvY2tldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjaGF0Lm1vZGFsKCcuYXV0aF9tb2RhbCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2hhdC5tb2RhbCgnLmNvbm5lY3RfbW9kYWwnLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBhdXRoLm9uKCdhdXRoJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICQuY29va2llKCduaWNrJywgZGF0YS5pZCk7XG4gICAgICAgICAgICB3aW5kb3cubmljayA9IGRhdGEubmljaztcbiAgICAgICAgICAgIGNoYXQubW9kYWwoJy5hdXRoX21vZGFsJywgdHJ1ZSk7XG4gICAgICAgICAgICBjaGF0LnVwZGF0ZV91c2VycyhkYXRhLnVzZXJzKTtcbiAgICAgICAgICAgIGNoYXQudXBkYXRlX3Jvb20oZGF0YS5yb29tcyk7XG4gICAgICAgIH0pO1xuICAgICAgICBhdXRoLm9uKCd1cGRhdGUnLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEudXNlcnMpIGNoYXQudXBkYXRlX3VzZXJzKGRhdGEudXNlcnMpO1xuICAgICAgICAgICAgaWYgKGRhdGEucm9vbXMpIGNoYXQudXBkYXRlX3Jvb20oZGF0YS5yb29tcyk7XG4gICAgICAgIH0pO1xuICAgICAgICBhdXRoLm9uKCdhdXRoX2VycicsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBjaGF0Lm1vZGFsKCcuYXV0aF9tb2RhbCcpO1xuICAgICAgICAgICAgYWxlcnQoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgICBhdXRoLm9uKCdhbGVydCcsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBhbGVydChkYXRhKTtcbiAgICAgICAgfSk7XG5cblxuICAgICAgICBjaGF0LnNldF9zb2NrZXQoe1xuICAgICAgICAgICAgYXV0aDogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhuYW1lKTtcbiAgICAgICAgICAgICAgICAvL2F1dGhfc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoe3R5cGU6ICdhdXRoJywgZGF0YTogbmFtZX0pKTtcbiAgICAgICAgICAgICAgICBjaGF0LnNlbmRfc29ja2V0KCdhdXRoJywgbmFtZSwgYXV0aF9zb2NrZXQpXG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByb29tX2Rpc2Nvbm5lY3Q6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Rpc2Nvbm5lY3QnLCBuYW1lKTtcbiAgICAgICAgICAgICAgICBjaGF0LnNlbmRfc29ja2V0KCdkaXNjb25uZWN0JywgbmFtZSwgc29ja2V0X3Jvb20pO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyb29tX2Rpc2Nvbm5lY3QnLCBuYW1lLCBKU09OLnBhcnNlKCdcIicrc29ja2V0X3Jvb20ubmFtZSsnXCInKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcm9vbV9zZXQ6IGZ1bmN0aW9uIChuYW1lLCBpZCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyb29tX3NldCcsIG5hbWUpO1xuICAgICAgICAgICAgICAgIHNvY2tldF9yb29tID0gbXVsdGlwbGV4ZXIuY2hhbm5lbChpZCk7XG4gICAgICAgICAgICAgICAgcm9vbSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuXG4gICAgICAgICAgICAgICAgc29ja2V0X3Jvb20ub25tZXNzYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YS50eXBlLCBkYXRhLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS50eXBlKSByb29tLmVtaXQoZGF0YS50eXBlLCBkYXRhLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIGNvbnNvbGUuZXJyb3IoJ9Ch0L7QvtCx0YnQtdC90LjQtSDQsdC10Lcg0YLQuNC/0LAhJywgZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcm9vbS5vbigndXBkYXRlJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEudXNlcnMpIGNoYXQudXBkYXRlX3VzZXJzKGRhdGEudXNlcnMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5yb29tcykgY2hhdC51cGRhdGVfcm9vbShkYXRhLnJvb21zKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByb29tLm9uKCdhbGVydCcsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJvb20ub24oJ2RlbF9tZXNzYWdlJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmxpc3QtbWVzc2FnZXMgdHJbZGF0YS1pZD1cIicrZGF0YSsnXCJdJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcm9vbS5vbigncm9vbScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy5tZXNzX3NlbmQnKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICAgICAkKCcubWVzc19zZW5kJykucGFyZW50KCkucGFyZW50KCkuZmluZCgnaW5wdXQnKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICAgICAkKCcubGlzdC1tZXNzYWdlcycpLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgICAgIGNoYXQudXBkYXRlX3VzZXJzKGRhdGEudXNlcnMpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhLmNoYXQpO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHRpbWUgaW4gZGF0YS5jaGF0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aW1lLGNoYXQuZ2V0X2RhdGUodGltZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3MgPSBkYXRhLmNoYXRbdGltZV07XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGF0LmFkZF9tZXNzKG1lc3MudXNlcl9uYW1lLCBtZXNzLm1lc3NhZ2UsIHRpbWUsIG1lc3MuaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICQoJy5kZWxfbWVzc2FnZScpLm9mZignY2xpY2snKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgpLmRhdGEoJ2lkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGF0LnNlbmRfc29ja2V0KCdkZWxfbWVzc2FnZScsIGlkLCBzb2NrZXRfcm9vbSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJvb20ub24oJ21lc3NhZ2UnLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBjaGF0LmFkZF9tZXNzKGRhdGEubmFtZSwgZGF0YS50ZXh0LCBkYXRhLnRpbWUsIGRhdGEuaWQpO1xuICAgICAgICAgICAgICAgICAgICAkKCcuZGVsX21lc3NhZ2UnKS5vZmYoJ2NsaWNrJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5kYXRhKCdpZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hhdC5zZW5kX3NvY2tldCgnZGVsX21lc3NhZ2UnLCBpZCwgc29ja2V0X3Jvb20pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNvY2tldF9yb29tLm9ub3BlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Nvbm5lY3QnLCBuYW1lLCBpZCk7XG4gICAgICAgICAgICAgICAgICAgIGNoYXQuc2VuZF9zb2NrZXQoJ2Nvbm5lY3QnLCBpZCwgc29ja2V0X3Jvb20pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYWRkX3Jvb206IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnYWRkX3Jvb20nLG5hbWUpO1xuICAgICAgICAgICAgY2hhdC5zZW5kX3NvY2tldCgnYWRkX3Jvb20nLCBuYW1lLCBhdXRoX3NvY2tldF9nbG9iYWwpXG4gICAgICAgIH0sXG4gICAgICAgIHNlbmQ6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBjaGF0LnNlbmRfc29ja2V0KCdtZXNzYWdlJywgZGF0YSwgc29ja2V0X3Jvb20pO1xuICAgICAgICB9XG4gICAgfVxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
